<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image inference through caching</title>
    <input type="checkbox" name="vehicle" value="Car" id="isCookie">
</head>
<body>

</body>
<script type="text/javascript">
    function httpGetAsync(theUrl, callback)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
    }

    httpGetAsync('/adUrls', function(response) {
        var urls = response.split('\n');

        urls.forEach(function(url, counter) {
            var xmlHttp1 = new XMLHttpRequest();
            var xmlHttp2 = new XMLHttpRequest();

            var start1;
            var start2;
            var end1;
            var end2;

            xmlHttp1.onreadystatechange = function() {
                if (xmlHttp1.readyState == 4 && xmlHttp1.status == 200) {
                    end1 = new Date().getTime();
//                    console.log("loadingTime 1 for image " + counter + ": " + (parseInt(end1) - parseInt((start1))));

                    start2 = new Date().getTime();
                    xmlHttp2.open("GET", url, true); // true for asynchronous
                    xmlHttp2.send(null);
                }
            };

            xmlHttp2.onreadystatechange = function() {
                if (xmlHttp2.readyState == 4 && xmlHttp2.status == 200) {
                    end2 = new Date().getTime();
//                    console.log("loadingTime 2 for image " + counter + ": " + (parseInt(end2) - parseInt((start2))));

                    var first = parseInt(end1) - parseInt((start1));
                    var third = parseInt(end2) - parseInt((start2));

                    console.log("difference for image " + counter + ": " + (first - third));

                    if((first - third) > 22) {
                        console.log("NOT CACHED: " + url);
                    } else {
                        console.log("CACHED: " + url);
                    }
                }
            };

            start1 = new Date().getTime();

            xmlHttp1.open("GET", url, true); // true for asynchronous
            xmlHttp1.send(null);
        });
    });

</script>
</html>